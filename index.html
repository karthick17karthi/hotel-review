<script type="module">
    // Import Firebase and Firestore functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCxCHfCbE-cosAvU9oAEaVtU-bUria5FYc",
        authDomain: "hotel-reviews-ef6e0.firebaseapp.com",
        projectId: "hotel-reviews-ef6e0",
        storageBucket: "hotel-reviews-ef6e0.appspot.com",
        messagingSenderId: "596063870907",
        appId: "1:596063870907:web:664665d4cd07448685ee9e",
        measurementId: "G-PDC6GSGDNW"
    };

    // Initialize Firebase and Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to add a review to Firestore
    async function addReviewToFirestore(review) {
        try {
            await addDoc(collection(db, "reviews"), {
                review: review,
                timestamp: serverTimestamp()
            });
            console.log("Review added successfully!");
            fetchReviews(); // Refresh the displayed reviews after adding a new one
        } catch (error) {
            console.error("Error adding review: ", error);
        }
    }

    // Function to fetch and display reviews from Firestore
    async function fetchReviews() {
        const querySnapshot = await getDocs(collection(db, "reviews"));
        const reviewsContainer = document.getElementById('reviews');
        reviewsContainer.innerHTML = ''; // Clear current reviews

        let goodCount = 0, averageCount = 0, badCount = 0;

        // Create containers for good, average, and bad reviews
        const goodReviewsContainer = document.createElement('div');
        const averageReviewsContainer = document.createElement('div');
        const badReviewsContainer = document.createElement('div');

        goodReviewsContainer.innerHTML = '<h3>Good Reviews</h3>';
        averageReviewsContainer.innerHTML = '<h3>Average Reviews</h3>';
        badReviewsContainer.innerHTML = '<h3>Bad Reviews</h3>';

        querySnapshot.forEach((doc) => {
            const reviewData = doc.data().review;
            const reviewElement = document.createElement('p');
            reviewElement.textContent = reviewData;

            // Classify each review and append it to the appropriate container
            if (reviewData.toLowerCase().includes("good")) {
                goodCount++;
                goodReviewsContainer.appendChild(reviewElement);
            } else if (reviewData.toLowerCase().includes("average")) {
                averageCount++;
                averageReviewsContainer.appendChild(reviewElement);
            } else {
                badCount++;
                badReviewsContainer.appendChild(reviewElement);
            }
        });

        // Append categorized reviews to the main container
        reviewsContainer.appendChild(goodReviewsContainer);
        reviewsContainer.appendChild(averageReviewsContainer);
        reviewsContainer.appendChild(badReviewsContainer);

        // Update counts in the UI
        document.getElementById('good-count').textContent = `Good Reviews: ${goodCount}`;
        document.getElementById('average-count').textContent = `Average Reviews: ${averageCount}`;
        document.getElementById('bad-count').textContent = `Bad Reviews: ${badCount}`;
    }

    // Ensure DOM elements are accessible after the page loads
    document.addEventListener("DOMContentLoaded", function() {
        // Handling the review submission
        document.getElementById('submit').addEventListener('click', function() {
            const reviewInput = document.getElementById('review');
            const review = reviewInput.value.trim();

            if (review) {
                addReviewToFirestore(review); // Add review to Firestore
                reviewInput.value = ''; // Clear the input field
            } else {
                alert("Please enter a review.");
            }
        });

        // Handling the clear button
        document.getElementById('clear').addEventListener('click', function() {
            document.getElementById('reviews').innerHTML = "";
            document.getElementById('good-count').textContent = "Good Reviews: 0";
            document.getElementById('average-count').textContent = "Average Reviews: 0";
            document.getElementById('bad-count').textContent = "Bad Reviews: 0";
        });

        // Load and display reviews on page load
        fetchReviews();
    });
</script>


